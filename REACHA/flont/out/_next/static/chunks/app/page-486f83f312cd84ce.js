(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1905:function(t,e,n){Promise.resolve().then(n.bind(n,8560))},8560:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return u}});var s=n(7437),a=n(2265),c=n(6463),r=n(6264);let i=["事業の全体像","外部環境と市場評価","競争優位と差別化要因","直近のニュース取得","世間の評価"];function o(){let[t,e]=(0,a.useState)([]),[n,o]=(0,a.useState)(""),[l,d]=(0,a.useState)([...i]),[u,h]=(0,a.useState)(!1),[m,p]=(0,a.useState)(!1),f=(0,c.useRouter)();async function x(t){if(t.preventDefault(),n){h(!0);try{await (0,r.sg)("/api/run",{company:n,queries:l}),f.push("/company/".concat(encodeURIComponent(n)))}finally{h(!1)}}}return(0,a.useEffect)(()=>{(0,r.R1)("/api/companies").then(t=>e(t.companies)).catch(()=>{})},[]),(0,s.jsxs)("form",{onSubmit:x,children:[(0,s.jsxs)("div",{className:"inputRow",children:[(0,s.jsx)("input",{list:"companyList",placeholder:"会社名を入力",value:n,onChange:t=>o(t.target.value)}),(0,s.jsx)("datalist",{id:"companyList",children:t.map(t=>(0,s.jsx)("option",{value:t},t))}),(0,s.jsxs)("button",{type:"button",className:"tab ".concat(m?"active":""),"aria-expanded":m,onClick:()=>p(t=>!t),title:"オプション設定",children:["オプション (",l.length,"/5)"]}),(0,s.jsx)("button",{type:"submit",disabled:u||!n,className:"btn btn-primary",children:u?(0,s.jsxs)("span",{style:{display:"inline-flex",alignItems:"center",gap:8},children:[(0,s.jsx)("span",{className:"spinner"}),"実行中…"]}):"実行"})]}),m&&(0,s.jsx)("div",{className:"card",style:{marginTop:10},children:(0,s.jsxs)("div",{className:"card-inner",children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[(0,s.jsx)("strong",{children:"実行対象"}),(0,s.jsxs)("span",{className:"muted",children:["(",l.length,"/5 選択) 未選択の場合は全件実行されます"]}),(0,s.jsx)("div",{style:{flex:1}}),(0,s.jsx)("button",{type:"button",className:"btn btn-ghost",onClick:function(){d([...i])},children:"全選択"}),(0,s.jsx)("button",{type:"button",className:"btn btn-ghost",onClick:function(){d([])},children:"全解除"})]}),(0,s.jsx)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},children:i.map(t=>(0,s.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,s.jsx)("input",{type:"checkbox",checked:l.includes(t),onChange:()=>{d(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])}}),(0,s.jsx)("span",{children:t})]},t))})]})})]})}var l=n(7138);function d(t){let{companies:e}=t,[n,c]=(0,a.useState)(e||[]),[i,o]=(0,a.useState)(new Map);async function d(t){if(confirm("「".concat(t,"」の結果を削除します。よろしいですか？")))try{await (0,r.QW)("/api/results/".concat(encodeURIComponent(t)));try{let t=await (0,r.R1)("/api/companies");c(t.companies)}catch(e){c(e=>e.filter(e=>e!==t))}}catch(t){alert("削除に失敗しました")}}return((0,a.useEffect)(()=>{c(e||[])},[e]),(0,a.useEffect)(()=>{let t=async()=>{let t=new Map;await Promise.all(n.map(async e=>{try{let n=await (0,r.R1)("/api/results/".concat(encodeURIComponent(e)));t.set(e,n.hasProposal||!1)}catch(n){t.set(e,!1)}})),o(t)};n.length>0&&t()},[n]),null==n?void 0:n.length)?(0,s.jsxs)("table",{className:"table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"会社名"}),(0,s.jsx)("th",{children:"操作"})]})}),(0,s.jsx)("tbody",{children:n.map(t=>{let e=i.get(t)||!1;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:t}),(0,s.jsxs)("td",{style:{display:"flex",gap:8},children:[(0,s.jsx)(l.default,{className:"btn btn-ghost",href:"/company/".concat(encodeURIComponent(t)),children:"会社情報を開く"}),e?(0,s.jsx)(l.default,{className:"btn btn-ghost",href:"/company/".concat(encodeURIComponent(t),"/proposal"),children:"提案結果を開く"}):(0,s.jsx)("button",{className:"btn btn-ghost",disabled:!0,style:{opacity:.5,cursor:"not-allowed"},title:"提案がまだ作成されていません",children:"提案結果を開く"}),(0,s.jsx)("button",{className:"btn btn-danger",onClick:()=>d(t),children:"削除"})]})]},t)})})]}):(0,s.jsx)("p",{className:"muted",children:"過去の結果はまだありません。"})}function u(){let[t,e]=(0,a.useState)([]);return(0,a.useEffect)(()=>{(0,r.R1)("/api/companies").then(t=>e(t.companies)).catch(()=>{})},[]),(0,s.jsxs)("div",{className:"container",children:[(0,s.jsx)("div",{className:"card",children:(0,s.jsxs)("div",{className:"card-inner",children:[(0,s.jsx)("h1",{style:{marginTop:0},children:"会社レポート"}),(0,s.jsx)("p",{className:"muted",children:"会社名を入力して実行、または既存結果を表示します。"}),(0,s.jsx)(o,{})]})}),(0,s.jsx)("div",{style:{height:16}}),(0,s.jsx)("div",{className:"card",children:(0,s.jsxs)("div",{className:"card-inner",children:[(0,s.jsx)("h2",{style:{marginTop:0},children:"過去の結果"}),(0,s.jsx)(d,{companies:t})]})})]})}},6264:function(t,e,n){"use strict";async function s(t){try{let e=await fetch(t,{next:{revalidate:0}});if(!e.ok){let n="GET ".concat(t," ").concat(e.status);try{let t=await e.json();t.detail&&(n=t.detail)}catch(s){n="GET ".concat(t," ").concat(e.status," ").concat(e.statusText)}throw Error(n)}return e.json()}catch(t){if(t instanceof Error){if(t.message.includes("Failed to fetch")||t.message.includes("NetworkError"))throw Error("ネットワークエラーが発生しました。接続を確認してください。");throw t}throw Error("予期しないエラーが発生しました")}}async function a(t,e,n){let s=(null==n?void 0:n.timeout)||6e5,a=new AbortController,c=setTimeout(()=>a.abort(),s);try{let n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),signal:a.signal});if(clearTimeout(c),!n.ok){let e="POST ".concat(t," ").concat(n.status);try{let t=await n.json();t.detail&&(e=t.detail)}catch(s){e="POST ".concat(t," ").concat(n.status," ").concat(n.statusText)}throw Error(e)}return n.json()}catch(t){if(clearTimeout(c),t instanceof Error){if("AbortError"===t.name)throw Error("リクエストがタイムアウトしました。時間がかかりすぎている可能性があります。しばらく待ってから再試行してください。");if(t.message.includes("Failed to fetch")||t.message.includes("NetworkError"))throw Error("ネットワークエラーが発生しました。接続を確認してください。");throw t}throw Error("予期しないエラーが発生しました")}}async function c(t){try{let e=await fetch(t,{method:"DELETE"});if(!e.ok){let n="DELETE ".concat(t," ").concat(e.status);try{let t=await e.json();t.detail&&(n=t.detail)}catch(s){n="DELETE ".concat(t," ").concat(e.status," ").concat(e.statusText)}throw Error(n)}return e.json()}catch(t){if(t instanceof Error){if(t.message.includes("Failed to fetch")||t.message.includes("NetworkError"))throw Error("ネットワークエラーが発生しました。接続を確認してください。");throw t}throw Error("予期しないエラーが発生しました")}}n.d(e,{QW:function(){return c},R1:function(){return s},sg:function(){return a}})}},function(t){t.O(0,[291,971,23,744],function(){return t(t.s=1905)}),_N_E=t.O()}]);