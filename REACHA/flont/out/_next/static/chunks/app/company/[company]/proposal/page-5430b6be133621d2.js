(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[608],{9744:function(t,e,r){Promise.resolve().then(r.bind(r,4469))},4469:function(t,e,r){"use strict";r.d(e,{default:function(){return l}});var n=r(7437),o=r(2265),a=r(6463),s=r(6264),c=r(9233);function l(t){let{company:e}=t,r=(0,a.useRouter)(),[l,i]=(0,o.useState)(null),[u,d]=(0,o.useState)(!0),[h,f]=(0,o.useState)(null),[m,p]=(0,o.useState)(null),[E,g]=(0,o.useState)(0),x=(0,o.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1?arguments[1]:void 0;try{t||d(!0),f(null),p(null);let n=null;n=setInterval(async()=>{if(null==r?void 0:r.aborted){n&&clearInterval(n);return}try{let t=await (0,s.R1)("/api/proposal/".concat(encodeURIComponent(e),"/progress"));(null==r?void 0:r.aborted)||!(t.current>0)||p({current:t.current,total:t.total})}catch(t){}},2e3);let o=await (0,s.sg)("/api/proposal/".concat(encodeURIComponent(e)),{},{timeout:12e5});(null==r?void 0:r.aborted)||(i(o.proposal),p(null),g(0)),n&&clearInterval(n)}catch(t){if(!(null==r?void 0:r.aborted)){let e=t instanceof Error?t.message:"提案の作成に失敗しました";console.error("Proposal creation error:",t),f(e),p(null)}}finally{(null==r?void 0:r.aborted)||d(!1)}},[e]);(0,o.useEffect)(()=>{let t=new AbortController;return x(!1,t.signal),()=>{t.abort()}},[x]);let y=(0,o.useCallback)(()=>{g(t=>t+1),x(!0)},[x]);return(0,n.jsxs)("div",{className:"container",children:[(0,n.jsxs)("h1",{children:[e," - 提案"]}),(0,n.jsx)("div",{style:{height:12}}),(0,n.jsx)("div",{style:{display:"flex",gap:8,marginBottom:16},children:(0,n.jsx)("button",{className:"btn",onClick:()=>r.push("/company/".concat(encodeURIComponent(e))),children:"← 戻る"})}),u&&(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16,padding:"40px 0"},children:[(0,n.jsx)("div",{className:"spinner"}),(0,n.jsxs)("p",{className:"muted",children:["提案を作成中...",m&&(0,n.jsxs)("span",{style:{display:"block",marginTop:8,fontSize:"0.9em"},children:[m.current," / ",m.total]})]})]}),h&&(0,n.jsxs)("div",{style:{padding:"20px",backgroundColor:"#fee",border:"1px solid #fcc",borderRadius:"4px",marginBottom:16},children:[(0,n.jsxs)("p",{style:{margin:0,color:"#c00",marginBottom:12},children:["エラー: ",h]}),(0,n.jsx)("button",{className:"btn",onClick:y,style:{marginTop:8},children:"再試行"}),E>0&&(0,n.jsxs)("p",{style:{margin:"8px 0 0 0",fontSize:"0.9em",color:"#666"},children:["再試行回数: ",E]})]}),!u&&!h&&l&&(0,n.jsx)("div",{children:(0,n.jsx)(c.Z,{content:l})})]})}},9233:function(t,e,r){"use strict";r.d(e,{Z:function(){return s}});var n=r(7437);r(2265);var o=r(27),a=r(7601);function s(t){let{content:e}=t;return(0,n.jsx)(o.U,{remarkPlugins:[a.Z],components:{a:t=>{let{node:e,...r}=t;return(0,n.jsx)("a",{...r})},h1:t=>{let{node:e,...r}=t;return(0,n.jsx)("h2",{...r})},h2:t=>{let{node:e,...r}=t;return(0,n.jsx)("h3",{...r})}},children:e||""})}},6264:function(t,e,r){"use strict";async function n(t){try{let e=await fetch(t,{next:{revalidate:0}});if(!e.ok){let r="GET ".concat(t," ").concat(e.status);try{let t=await e.json();t.detail&&(r=t.detail)}catch(n){r="GET ".concat(t," ").concat(e.status," ").concat(e.statusText)}throw Error(r)}return e.json()}catch(t){if(t instanceof Error){if(t.message.includes("Failed to fetch")||t.message.includes("NetworkError"))throw Error("ネットワークエラーが発生しました。接続を確認してください。");throw t}throw Error("予期しないエラーが発生しました")}}async function o(t,e,r){let n=(null==r?void 0:r.timeout)||6e5,o=new AbortController,a=setTimeout(()=>o.abort(),n);try{let r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),signal:o.signal});if(clearTimeout(a),!r.ok){let e="POST ".concat(t," ").concat(r.status);try{let t=await r.json();t.detail&&(e=t.detail)}catch(n){e="POST ".concat(t," ").concat(r.status," ").concat(r.statusText)}throw Error(e)}return r.json()}catch(t){if(clearTimeout(a),t instanceof Error){if("AbortError"===t.name)throw Error("リクエストがタイムアウトしました。時間がかかりすぎている可能性があります。しばらく待ってから再試行してください。");if(t.message.includes("Failed to fetch")||t.message.includes("NetworkError"))throw Error("ネットワークエラーが発生しました。接続を確認してください。");throw t}throw Error("予期しないエラーが発生しました")}}async function a(t){try{let e=await fetch(t,{method:"DELETE"});if(!e.ok){let r="DELETE ".concat(t," ").concat(e.status);try{let t=await e.json();t.detail&&(r=t.detail)}catch(n){r="DELETE ".concat(t," ").concat(e.status," ").concat(e.statusText)}throw Error(r)}return e.json()}catch(t){if(t instanceof Error){if(t.message.includes("Failed to fetch")||t.message.includes("NetworkError"))throw Error("ネットワークエラーが発生しました。接続を確認してください。");throw t}throw Error("予期しないエラーが発生しました")}}r.d(e,{QW:function(){return a},R1:function(){return n},sg:function(){return o}})}},function(t){t.O(0,[760,971,23,744],function(){return t(t.s=9744)}),_N_E=t.O()}]);