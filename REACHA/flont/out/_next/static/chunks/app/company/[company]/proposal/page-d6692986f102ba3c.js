(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[608],{5546:function(t,e,r){Promise.resolve().then(r.bind(r,4469))},4469:function(t,e,r){"use strict";r.d(e,{default:function(){return c}});var o=r(7437),n=r(2265),a=r(6463),l=r(6264),s=r(9233);function c(t){let{company:e}=t,r=(0,a.useRouter)(),[c,i]=(0,n.useState)(null),[u,d]=(0,n.useState)(!0),[h,f]=(0,n.useState)(null),[p,m]=(0,n.useState)(null),[g,E]=(0,n.useState)(0),w=(0,n.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1?arguments[1]:void 0,o=null,n=null,a=!1;try{t||d(!0),f(null),m(null),o=setInterval(async()=>{if(null==r?void 0:r.aborted){o&&clearInterval(o);return}try{let t=await (0,l.R1)("/api/proposal/".concat(encodeURIComponent(e),"/progress"));if(!(null==r?void 0:r.aborted)&&(t.current>0&&m({current:t.current,total:t.total}),"idle"===t.status||"completed"===t.status||t.current===t.total&&t.total>0)){await new Promise(t=>setTimeout(t,1e3));try{let t=await (0,l.sg)("/api/proposal/".concat(encodeURIComponent(e)),{},{timeout:1e4});!(null==r?void 0:r.aborted)&&t.proposal&&(i(t.proposal),m(null),E(0),d(!1),a=!0,n&&n.abort(),o&&clearInterval(o))}catch(t){console.debug("Proposal not ready yet, continuing to wait...")}}}catch(t){}},2e3),n=new AbortController;try{let t=await (0,l.sg)("/api/proposal/".concat(encodeURIComponent(e)),{},{timeout:12e5,signal:n.signal});(null==r?void 0:r.aborted)||a||(i(t.proposal),m(null),E(0))}catch(t){if(!(null==r?void 0:r.aborted)&&!a){let e=t instanceof Error?t.message:"提案の作成に失敗しました";e.includes("タイムアウト")&&a||(console.error("Proposal creation error:",t),f(e),m(null))}}o&&clearInterval(o)}catch(t){if(!(null==r?void 0:r.aborted)){let e=t instanceof Error?t.message:"提案の作成に失敗しました";console.error("Proposal creation error:",t),f(e),m(null)}}finally{(null==r?void 0:r.aborted)||a||d(!1)}},[e]);(0,n.useEffect)(()=>{let t=new AbortController;return w(!1,t.signal),()=>{t.abort()}},[w]);let y=(0,n.useCallback)(()=>{E(t=>t+1),w(!0)},[w]);return(0,o.jsxs)("div",{className:"container",children:[(0,o.jsxs)("h1",{children:[e," - 提案"]}),(0,o.jsx)("div",{style:{height:12}}),(0,o.jsx)("div",{style:{display:"flex",gap:8,marginBottom:16},children:(0,o.jsx)("button",{className:"btn",onClick:()=>r.push("/company/".concat(encodeURIComponent(e))),children:"← 戻る"})}),u&&(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16,padding:"40px 0"},children:[(0,o.jsx)("div",{className:"spinner"}),(0,o.jsxs)("p",{className:"muted",children:["提案を作成中...",p&&(0,o.jsxs)("span",{style:{display:"block",marginTop:8,fontSize:"0.9em"},children:[p.current," / ",p.total]})]})]}),h&&(0,o.jsxs)("div",{style:{padding:"20px",backgroundColor:"#fee",border:"1px solid #fcc",borderRadius:"4px",marginBottom:16},children:[(0,o.jsxs)("p",{style:{margin:0,color:"#c00",marginBottom:12},children:["エラー: ",h]}),(0,o.jsx)("button",{className:"btn",onClick:y,style:{marginTop:8},children:"再試行"}),g>0&&(0,o.jsxs)("p",{style:{margin:"8px 0 0 0",fontSize:"0.9em",color:"#666"},children:["再試行回数: ",g]})]}),!u&&!h&&c&&(0,o.jsx)("div",{children:(0,o.jsx)(s.Z,{content:c})})]})}},9233:function(t,e,r){"use strict";r.d(e,{Z:function(){return l}});var o=r(7437);r(2265);var n=r(27),a=r(7601);function l(t){let{content:e}=t;return(0,o.jsx)(n.U,{remarkPlugins:[a.Z],components:{a:t=>{let{node:e,...r}=t;return(0,o.jsx)("a",{...r})},h1:t=>{let{node:e,...r}=t;return(0,o.jsx)("h2",{...r})},h2:t=>{let{node:e,...r}=t;return(0,o.jsx)("h3",{...r})}},children:e||""})}},6264:function(t,e,r){"use strict";async function o(t){try{let e=await fetch(t,{next:{revalidate:0}});if(!e.ok){let r="GET ".concat(t," ").concat(e.status);try{let t=await e.json();t.detail&&(r=t.detail)}catch(o){r="GET ".concat(t," ").concat(e.status," ").concat(e.statusText)}throw Error(r)}return e.json()}catch(t){if(t instanceof Error){if(t.message.includes("Failed to fetch")||t.message.includes("NetworkError"))throw Error("ネットワークエラーが発生しました。接続を確認してください。");throw t}throw Error("予期しないエラーが発生しました")}}async function n(t,e,r){let o=(null==r?void 0:r.timeout)||6e5,n=null==r?void 0:r.signal,a=new AbortController,l=setTimeout(()=>a.abort(),o);n&&n.addEventListener("abort",()=>{a.abort()});try{let r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),signal:a.signal});if(clearTimeout(l),!r.ok){let e="POST ".concat(t," ").concat(r.status);try{let t=await r.json();t.detail&&(e=t.detail)}catch(o){e="POST ".concat(t," ").concat(r.status," ").concat(r.statusText)}throw Error(e)}return r.json()}catch(t){if(clearTimeout(l),t instanceof Error){if("AbortError"===t.name){if(null==n?void 0:n.aborted)throw Error("リクエストがキャンセルされました");throw Error("リクエストがタイムアウトしました。時間がかかりすぎている可能性があります。しばらく待ってから再試行してください。")}if(t.message.includes("Failed to fetch")||t.message.includes("NetworkError"))throw Error("ネットワークエラーが発生しました。接続を確認してください。");throw t}throw Error("予期しないエラーが発生しました")}}async function a(t){try{let e=await fetch(t,{method:"DELETE"});if(!e.ok){let r="DELETE ".concat(t," ").concat(e.status);try{let t=await e.json();t.detail&&(r=t.detail)}catch(o){r="DELETE ".concat(t," ").concat(e.status," ").concat(e.statusText)}throw Error(r)}return e.json()}catch(t){if(t instanceof Error){if(t.message.includes("Failed to fetch")||t.message.includes("NetworkError"))throw Error("ネットワークエラーが発生しました。接続を確認してください。");throw t}throw Error("予期しないエラーが発生しました")}}r.d(e,{QW:function(){return a},R1:function(){return o},sg:function(){return n}})}},function(t){t.O(0,[760,971,23,744],function(){return t(t.s=5546)}),_N_E=t.O()}]);